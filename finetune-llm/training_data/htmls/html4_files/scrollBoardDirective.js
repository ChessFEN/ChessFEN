"use strict";chessStories.directive("appScrollBoard",["themeService","Kbd",function(e,o){function l(e,o,l){if(e){var r=e.moves,i=(o>=0?r[o].fen:e.body[0].fen).split(" ");l.board.position(i[0],!1,null)}else l.board.position("start",!1,null),l.board.orientation("white");l.game=e,l.ply=o}return{restrict:"EA",scope:{preview:"=",selectedGame:"="},templateUrl:"/static001767/app/shared/scrollBoard/scrollBoardView.html",link:function(r,i,t){var n={pieceTheme:e.url_of_piece,showNotation:!1,position:"start"},a=r.preview;a.board_id="preview-board-"+Math.round(1e16*Math.random()).toString(),a.scroll_id="preview-scroll-"+Math.round(1e16*Math.random()).toString(),$(".preview-board",i).attr("id",a.board_id),$(".preview-board-scroll",i).attr("id",a.scroll_id),a.board=ChessBoard(a.board_id,n);var s=r;$("#"+a.scroll_id).on("scroll",function(e){var o=s.selectedGame;if(o){var r=o.moves;if(r&&0!=r.length){var i=r.length,t=function(e){return e.scroll_el=$("#"+e.scroll_id),e.max_scroll=$("DIV",e.scroll_el).outerWidth()-e.scroll_el.outerWidth(),e.scroll_el.scrollLeft()/(e.max_scroll+1)}(a);l(o,Math.floor((i+1)*t)-1,a)}}});$("#"+a.scroll_id).on("keydown",function(e){e.keyCode==o.LEFT?r.onPreviewBack(e):e.keyCode==o.RIGHT?r.onPreviewFwd(e):e.keyCode==o.HOME?r.onPreviewHome(e):e.keyCode==o.END&&r.onPreviewEnd(e)})},controller:["$scope","$timeout",function(e,o){var r=e.preview;function i(e,i){o(function(){if(r.scroll_el=$("#"+r.scroll_id),r.max_scroll=$("DIV",r.scroll_el).outerWidth()-r.scroll_el.outerWidth(),e){var o=e.moves.length;r.scroll_el.scrollLeft(r.max_scroll*(i+1)/o),l(e,i,r)}else r.scroll_el.scrollLeft(0),r.board.position("8/8/8/8/8/8/8/8 w KQkq - 0 1"),r.board.orientation("white")},1)}r.board_id=null,r.scroll_id=null,r.board=null,r.scroll_el=null,r.max_scroll=1,e.is_touch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,e.onPreviewHome=function(e){i(r.game,-1)},e.onPreviewBack=function(e){r.game&&_.isFinite(r.ply)&&r.ply>=0&&i(r.game,r.ply-1)},e.onPreviewFwd=function(e){r.game&&_.isFinite(r.ply)&&r.ply<r.game.moves.length-1&&i(r.game,r.ply+1)},e.onPreviewEnd=function(e){r.game&&i(r.game,r.game.moves.length-1)},e.$watch("selectedGame",function(e){e?(i(e,e.moves.length-1),o(function(){$("#"+r.scroll_id).focus()},1)):i(null,-1)}),e.$on("preview-set",(e,o)=>{var[l,r]=o;i(l,r)})}]}}]);
