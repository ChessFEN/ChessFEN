"use strict";chessStories.service("authService",["$window","httpWrapperService","$rootScope","Config",function(n,e,t,r){var a={},u={board:"00",pieces:"00",dark:"s",sound:"click"};function i(){return{en:"english",es:"spanish",pt:"portuguese",fr:"french",de:"german",ru:"russian",no:"norwegian",nl:"dutch",it:"italian",he:"hebrew"}[n.navigator.language.substr(0,2)]||"english"}function l(n,e,r,a,u,l){var s=n!=t.currentUser.login_name||a!=t.currentUser.level;t.currentUser={login_name:n,fullname:e,email:r,level:a,lang:u||i(),prefs:l},s&&t.$emit("user-set",{username:t.currentUser.login_name})}function s(n,t){var a=r.API.host+"/api/v1.1/login_info?f="+(n?"1":"0");return e.get(a,{})}return a.login=function(n){return e.get(r.API.host+"/api/v1.1/login",{withCredentials:!0,params:n}).then(function(n){var e=n.data;return"ok"===e.status&&l(e.username,e.fullname,e.email,e.level,e.lang,e.prefs),n})},a.isLoggedInAsync=function(n,e){if(n||(n=function(){}),t.currentUser.login_name)return n(!0);"web"!==r.platform||window.Cookies()[r.sess_cookie.name]?s(e).then(function(e){return window.dc_comm_err=!1,e.data&&"notloggedin"==e.data.status?(l(null,null,null,"guest",null,u),n(!1)):(l(e.data.username,e.data.fullname,e.data.email,e.data.level,e.data.lang,e.data.prefs),n(!0))}).catch(function(e){return window.dc_comm_err=!0,n(!1)}):s(e).then(function(){return n(!1)})},a.logout=function(){return $(window).unbind(),l(null,null,null,"guest",null,{}),window.Cookies.remove(r.sess_cookie.name,{domain:r.sess_cookie.domain}),e.get(r.API.host+"/api/v1.1/logout",{withCredentials:!0})},a.signup=function(n){const{fullname:a,email:u,password:i}=n,s=u,o=n.contactConsent?1:0,{lang:c,prefs:g}=t.currentUser;return e.get(r.API.host+"/api/v1.1/signup",{withCredentials:!0,params:{n:a,u:s,p:i,e:u,s:o}}).then(function(n){var e=n.data;return"ok"===e.status&&l(s,a,u,e.level,c,g),n})},a.clear_login=function(){l(null,null,null,"guest",null,{})},t.currentUser={level:"guest",lang:i(),prefs:u},a}]);
