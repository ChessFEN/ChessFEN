"use strict";chessStories.directive("appTagsDlg",[function(){return{restrict:"EA",templateUrl:"/static001767/app/shared/tags/tagsView.html",controllerAs:"tags",controller:["$scope","$timeout","Kbd",function(t,n,e){var o=this;function c(){n(function(){$(".tags-cont input").focus()})}o.tag_infos=[],o.show=!1,o.openDlg=function(t,n){o.tag_infos=t||[],o.show=!0,o.cb=n,c()},o.closeDlg=function(){o.show=!1,o.cb&&o.cb("end",o.tag_infos)},o.isOpen=function(){return o.show},o.getTags=function(){return _.map(_.filter(o.tag_infos,function(t){return t.selected}),function(t){return t.tag})},o.onChkChange=function(t,n){if(o.cb){var e=o.tag_infos[t];o.cb(e.selected?"add":"delete",e.tag)}},o.onAddKeyPress=function(t){13==t.which&&o.onAddOk()},o.onAddOk=function(){c();var n=(o.tag_to_add||"").replace(/[ ,]+/g," ").trim();if(o.tag_to_add="",n){var e=n.toLowerCase(),s=_.find(o.tag_infos,function(t){return t.tag.toLowerCase()==e});if(s)return s.selected?void 0:(s.selected=!0,o.tag_infos=_.map(o.tag_infos,function(t){return t}),void(o.cb&&o.cb("add",n)));var a={tag:n,id:t.guid(),selected:!0};return o.tag_infos=o.tag_infos.concat(a),void(o.cb&&o.cb("add",n))}},o.onCancelBtn=function(){t.ga("tags","close-by-cancel-btn",""),o.closeDlg()},t.$on("Esc",function(n,e){o.show&&(t.ga("tags","close-by-esc",""),o.closeDlg())})}]}}]);
