"use strict";angular.module("chessStories").controller("sharedController",["$scope","$timeout","$state","$stateParams","shareService",function(e,t,o,n,r){var a,i,s,c=n.k;function u(){r.get(c,function(t){if(t.msg)e.popupMsg.showText(t.msg);else{var o=t.data,n=e.getPristineTab();e.selectTab(n),n.share_key=c,n.board_orientation=o.bo;var r=new Game(o.game);r.share_key=c;var a=r.curr_move;o.view[a]=a,n.set_game(r,o.view),function(t,o){var n=o.decode_type,r="game"==n?null:o.decoded_fen,a="game"==n?null:o.decoded_mv,i=_.find(t.jobs,function(e){return!(e.jparam.type!=n||r&&e.jparam.fen!=r||a&&e.jparam.next_move_uci!=a)});i&&e.selectJob(t,i)}(n,o),o.view&&(o.view.topic&&n.currJob&&n.currJob.topic&&(n.currJob.topic=o.view.topic),n.threats_status_now=!!o.view.threats_status_now),o.fen!=a.fen&&e.setFen(o.fen)}})}t(function(){var t=e.currentUser.level;e.ga("view-share","",t)},1200),a=function(){return!!e.board_initialized&&(u(),!0)},i="board-init",s=0,function e(){++s>20?console.log("*** waiting too long for "+i+"; giving up."):(console.log("...waiting for "+i+", attempt n#"+s),a()||t(e,100))}(),o.go("index")}]);
